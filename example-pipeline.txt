
  # Set up Maven to use the custom cache path
  - script: |
      mkdir -p $(mavenRootFolder)
      echo "<settings><localRepository>$(mavenCacheFolder)</localRepository></settings>" > $(mavenRootFolder)settings.xml
    displayName: 'Prepare Maven local repo'

  # Cache Maven dependencies
  - task: Cache@2
    inputs:
      key: 'maven | "$(Agent.OS)" | **/pom.xml'
      restoreKeys: |
        maven | "$(Agent.OS)"
      path: $(mavenCacheFolder)
  - task: Maven@4
    displayName: 'Maven Build'
    inputs:
      mavenPomFile: 'pom.xml'
      options: >
        -DnvdApiKey=$(nvdAPIKey)
        -Dsonar.projectKey=LTheobald_kafka-testbed
        --settings $(mavenRootFolder)settings.xml
      mavenOptions: '-Xmx3072m'
      javaHomeOption: 'JDKVersion'
      jdkVersionOption: '1.21'
      jdkArchitectureOption: 'x64'
      publishJUnitResults: true
      testResultsFiles: '**/surefire-reports/TEST-*.xml'
      goals: 'clean verify sonar:sonar package'